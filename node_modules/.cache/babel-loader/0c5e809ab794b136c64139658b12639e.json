{"ast":null,"code":"import _slicedToArray from\"/Users/austenleow/Desktop/travel-app-main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/austenleow/Desktop/travel-app-main/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/austenleow/Desktop/travel-app-main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React,{useState,createContext}from\"react\";import{AuthenticationDetails,CognitoUser,Cgnito}from\"amazon-cognito-identity-js\";import Pool from\"./UserPool\";import{jsx as _jsx}from\"react/jsx-runtime\";var AccountContext=/*#__PURE__*/createContext();var Account=function Account(props){var getSession=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return new Promise(function(resolve,reject){var user=Pool.getCurrentUser();if(user){user.getSession(function(err,session){if(err){reject();}else{resolve(session);}});}else{reject();}});case 2:return _context.abrupt(\"return\",_context.sent);case 3:case\"end\":return _context.stop();}}},_callee);}));return function getSession(){return _ref.apply(this,arguments);};}();var confirmCode=function confirmCode(user,Username,Password){var code=prompt(\"Please enter ur verification code\");user.confirmRegistration(code);authenticate(Username,Password);};var authenticate=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(Username,Password){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return new Promise(function(resolve,reject){var user=new CognitoUser({Username:Username,Pool:Pool});var authDetails=new AuthenticationDetails({Username:Username,Password:Password});user.authenticateUser(authDetails,{onSuccess:function onSuccess(data){console.log(\"onSuccess: \",data);// resolve(data.getIdToken().getJwtToken());   // jwt id token is here\nvar tokens={accessToken:data.getAccessToken().getJwtToken(),idToken:data.getIdToken().getJwtToken(),refreshToken:data.getRefreshToken().getToken()};user['tokens']=tokens;console.log(user);setToken(data.getIdToken().getJwtToken());resolve(user);},onFailure:function onFailure(err){if(err.toString().includes(\"UserNotConfirmedException\")){confirmCode(user,Username,Password);}console.log(\"onFailure: \",err);reject(err);},newPasswordRequired:function newPasswordRequired(data){console.log(\"newPasswordRequired: \",data);resolve(data);}});});case 2:return _context2.abrupt(\"return\",_context2.sent);case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function authenticate(_x,_x2){return _ref2.apply(this,arguments);};}();var signUp=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(email,password){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return new Promise(function(resolve,reject){Pool.signUp(email,password,[],null,function(err,data){if(err){console.log(err);}console.log(data);},{onSuccess:function onSuccess(data){console.log(\"onSuccess: \",data);alert(\"Success! Go and login now!\");setToken(data.getIdToken().getJwtToken());resolve(data);},onFailure:function onFailure(err){console.error(\"onFailure: \",err);reject(err);}});});case 2:return _context3.abrupt(\"return\",_context3.sent);case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function signUp(_x3,_x4){return _ref3.apply(this,arguments);};}();var logout=function logout(){var user=Pool.getCurrentUser();if(user){user.signOut();}setToken(null);};var initialToken;if(authenticate){initialToken=authenticate;}// if (signUp) {\n//   initialToken = signUp;\n// }\nvar _useState=useState(initialToken),_useState2=_slicedToArray(_useState,2),token=_useState2[0],setToken=_useState2[1];var isLoggedIn=!!token;// console.log(token);\nreturn/*#__PURE__*/_jsx(AccountContext.Provider,{value:{authenticate:authenticate,getSession:getSession,signUp:signUp,logout:logout,isLoggedIn:isLoggedIn},children:props.children});};export{Account,AccountContext};","map":{"version":3,"names":["React","useState","createContext","AuthenticationDetails","CognitoUser","Cgnito","Pool","AccountContext","Account","props","getSession","Promise","resolve","reject","user","getCurrentUser","err","session","confirmCode","Username","Password","code","prompt","confirmRegistration","authenticate","authDetails","authenticateUser","onSuccess","data","console","log","tokens","accessToken","getAccessToken","getJwtToken","idToken","getIdToken","refreshToken","getRefreshToken","getToken","setToken","onFailure","toString","includes","newPasswordRequired","signUp","email","password","alert","error","logout","signOut","initialToken","token","isLoggedIn","children"],"sources":["/Users/austenleow/Desktop/travel-app-main/src/components/cognito-api/Account.js"],"sourcesContent":["import React, { useState, createContext} from \"react\";\nimport { AuthenticationDetails, CognitoUser, Cgnito } from \"amazon-cognito-identity-js\";\nimport Pool from \"./UserPool\";\n\n\nconst AccountContext = createContext();\n\nconst Account = (props) => {\n\n  const getSession = async () => {\n    return await new Promise((resolve, reject) => {\n      const user = Pool.getCurrentUser();\n      if (user){\n        user.getSession((err, session) => {\n          if (err){\n            reject();\n          }\n          else {\n            resolve(session)\n          }\n        });\n      }\n      else {\n        reject();\n      }}) \n  }\n\n  const confirmCode = (user, Username, Password) => {\n    const code = prompt(\"Please enter ur verification code\")\n    user.confirmRegistration(code)\n    authenticate(Username, Password)\n  }\n\n  const authenticate = async (Username, Password) => {\n    return await new Promise ((resolve, reject) => {\n      const user = new CognitoUser({\n        Username,\n        Pool\n      })\n  \n      const authDetails = new AuthenticationDetails({\n        Username,\n        Password,\n      })\n  \n      user.authenticateUser(authDetails, {\n        onSuccess: (data) => {\n          console.log(\"onSuccess: \", data)\n          // resolve(data.getIdToken().getJwtToken());   // jwt id token is here\n          const tokens = {\n            accessToken: data.getAccessToken().getJwtToken(),\n            idToken: data.getIdToken().getJwtToken(),\n            refreshToken: data.getRefreshToken().getToken()\n          };\n          user['tokens'] = tokens;\n          console.log(user);\n          setToken(data.getIdToken().getJwtToken());\n          resolve(user);\n        },\n        onFailure: (err) => {\n          if (err.toString().includes(\"UserNotConfirmedException\") ){\n            confirmCode(user, Username, Password)\n          }\n          console.log(\"onFailure: \", err)\n          reject(err)\n        },\n        newPasswordRequired: (data) => {\n          console.log(\"newPasswordRequired: \", data)\n          resolve(data)\n        }\n      })\n    })\n  }\n  \n  const signUp = async (email, password) => {\n    return await new Promise ((resolve, reject) => {\n      Pool.signUp(email, password, [], null, (err, data) => {\n     \n        if (err) {\n          console.log(err)\n        }\n        console.log(data)\n      }, {\n        onSuccess: (data) => {\n          console.log(\"onSuccess: \", data)\n          alert(\"Success! Go and login now!\");\n          setToken(data.getIdToken().getJwtToken());\n          resolve(data);\n        },\n        onFailure: (err) => {\n          console.error(\"onFailure: \", err)\n          reject(err)\n        },\n      })\n    })  \n  };\n\n  const logout = () => {\n    const user = Pool.getCurrentUser();\n    if (user) {\n      user.signOut();\n    }\n    setToken(null);\n  }\n\n  let initialToken;\n  if (authenticate) {\n    initialToken = authenticate;\n  } \n  // if (signUp) {\n  //   initialToken = signUp;\n  // }\n  const [token, setToken] = useState(initialToken);\n  const isLoggedIn = !!token;\n  // console.log(token);\n\n  return (\n    <AccountContext.Provider value={{authenticate, getSession, signUp, logout, isLoggedIn}}>\n      {props.children}\n    </AccountContext.Provider>\n  )\n\n};\n\nexport {Account, AccountContext};"],"mappings":"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"},"metadata":{},"sourceType":"module"}